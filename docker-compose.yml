services:
  # Tax Chatbot API Application
  tax_chatbot:
    build:
      context: .
      dockerfile: dockerfile
    container_name: taxbot_api
    environment:
      # Database Configuration
      DATABASE_URL: ${DATABASE_URL}
      
      # API Keys
      GROQ_API_KEY: ${GROQ_API_KEY}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      TAVILY_API_KEY: ${TAVILY_API_KEY}
      YARN_API_KEY: ${YARN_API_KEY}
      ENDPOINT_AUTH_KEY: ${ENDPOINT_AUTH_KEY}
      
      # Model Configuration
      GROQ_MODEL: ${GROQ_MODEL:-llama-3.3-70b-versatile}
      GEMINI_MODEL: ${GEMINI_MODEL:-gemini-flash-latest}
      TEMPERATURE: ${TEMPERATURE:-0.3}
      MAX_TOKENS: ${MAX_TOKENS:-8096}
      HUGGINGFACE_EMBED_MODEL: ${HUGGINGFACE_EMBED_MODEL:-sentence-transformers/all-MiniLM-L6-v2}
    ports:
      - "8080:8080"
    volumes:
      # Persist vector database
      - ./chroma_db:/app/chroma_db
      # Persist dataset
      - ./dataset:/app/dataset
    networks:
      - taxbot_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  taxbot_network:
    driver: bridge
